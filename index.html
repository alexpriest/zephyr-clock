<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zephyr's Day Clock</title>

    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Zephyr Clock">

    <!-- Prevent text selection and callouts -->
    <meta name="format-detection" content="telephone=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Comic Sans MS', 'Chalkboard', sans-serif;
            padding: 40px 20px;
            padding-top: max(50px, env(safe-area-inset-top, 50px));
            padding-bottom: max(50px, env(safe-area-inset-bottom, 50px));
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        @media (orientation: landscape) and (min-width: 700px) {
            .container {
                flex-direction: row;
                justify-content: center;
                align-items: center;
                gap: 40px;
            }

            h1 {
                position: absolute;
                top: max(20px, env(safe-area-inset-top, 20px));
                left: 50%;
                transform: translateX(-50%);
                font-size: 2rem;
                margin: 0;
            }

            .clock-container {
                width: min(50vh, 500px);
                height: min(50vh, 500px);
                flex-shrink: 0;
            }

            .sidebar {
                align-items: center;
            }

            .current-activity {
                margin-top: 0;
                text-align: center;
            }

            .legend {
                margin-top: 0;
                justify-content: center;
                max-width: 350px;
            }
        }

        h1 {
            color: #fff;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .clock-container {
            position: relative;
            width: min(70vw, 55vh, 500px);
            height: min(70vw, 55vh, 500px);
            aspect-ratio: 1 / 1;
            flex-shrink: 0;
        }

        .clock {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 60px rgba(255,255,255,0.1);
            aspect-ratio: 1 / 1;
        }

        .clock-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            z-index: 20;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg);
            width: 8px;
            height: 38%;
            background: linear-gradient(to top, #fff, #ffd700);
            border-radius: 4px;
            z-index: 15;
            box-shadow: 0 0 15px rgba(255,215,0,0.5);
        }

        .second-hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg);
            width: 2px;
            height: 42%;
            background: rgba(255,255,255,0.5);
            border-radius: 1px;
            z-index: 14;
        }

        .confetti {
            position: fixed;
            pointer-events: none;
            z-index: 100;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            opacity: 0;
            animation: confetti-fall 3s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(400px) rotate(720deg) scale(0.5);
            }
        }

        .current-activity {
            margin-top: 30px;
            padding: 20px 40px;
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .current-activity h2 {
            color: #ffd700;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .current-activity p {
            color: #fff;
            font-size: 1.8rem;
        }

        .current-time {
            color: rgba(255,255,255,0.7);
            font-size: 1rem;
            margin-top: 10px;
        }

        .legend {
            margin-top: 25px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px 20px;
            max-width: 600px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
            font-size: 1rem;
            padding: 6px 10px;
            border-radius: 8px;
            transition: background 1s ease, box-shadow 1s ease;
            cursor: pointer;
        }

        .legend-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .legend-item.active,
        .legend-item.highlighted {
            background: rgba(255,215,0,0.2);
            box-shadow: 0 0 12px rgba(255,215,0,0.4);
        }

        .legend-item.fading {
            background: rgba(255,215,0,0);
            box-shadow: 0 0 0px rgba(255,215,0,0);
        }

        .legend-color {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .tap-hint {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.15);
            color: rgba(255,255,255,0.7);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            transition: opacity 0.5s ease;
            z-index: 50;
        }

        .tap-hint.hidden {
            opacity: 0;
            pointer-events: none;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .clock-segment {
            transition: filter 1s ease;
        }

        .clock-segment.highlighted {
            filter: drop-shadow(0 0 8px rgba(255,215,0,0.8)) brightness(1.2);
        }

        .clock-segment.fading {
            filter: drop-shadow(0 0 0px rgba(255,215,0,0)) brightness(1);
        }
    </style>
</head>
<body>
    <h1>Zephyr's Day Clock</h1>

    <div class="container">
        <div class="clock-container">
            <div class="clock">
                <svg viewBox="0 0 240 240" id="clock-svg">
                    <!-- Segments will be drawn here -->
                </svg>
                <div class="second-hand" id="second-hand"></div>
                <div class="hand" id="hand"></div>
                <div class="clock-center"></div>
            </div>
        </div>

        <div class="sidebar">
            <div class="current-activity">
                <h2>Right Now:</h2>
                <p id="activity-text">Loading...</p>
                <div class="current-time" id="current-time"></div>
            </div>

            <div class="legend" id="legend"></div>
        </div>
    </div>

    <div class="tap-hint" id="tap-hint">Tap anywhere to enable sounds</div>

    <script>
        // Create audio context for gentle chime
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                document.getElementById('tap-hint').classList.add('hidden');
            }
        }

        function playChime() {
            if (!audioContext) return;

            // Create a gentle, pleasant chime
            const now = audioContext.currentTime;

            // First tone
            const osc1 = audioContext.createOscillator();
            const gain1 = audioContext.createGain();
            osc1.type = 'sine';
            osc1.frequency.setValueAtTime(523.25, now); // C5
            gain1.gain.setValueAtTime(0.3, now);
            gain1.gain.exponentialRampToValueAtTime(0.01, now + 1.5);
            osc1.connect(gain1);
            gain1.connect(audioContext.destination);
            osc1.start(now);
            osc1.stop(now + 1.5);

            // Second tone (harmony)
            const osc2 = audioContext.createOscillator();
            const gain2 = audioContext.createGain();
            osc2.type = 'sine';
            osc2.frequency.setValueAtTime(659.25, now + 0.15); // E5
            gain2.gain.setValueAtTime(0, now);
            gain2.gain.setValueAtTime(0.2, now + 0.15);
            gain2.gain.exponentialRampToValueAtTime(0.01, now + 1.8);
            osc2.connect(gain2);
            gain2.connect(audioContext.destination);
            osc2.start(now + 0.15);
            osc2.stop(now + 1.8);

            // Third tone (resolve)
            const osc3 = audioContext.createOscillator();
            const gain3 = audioContext.createGain();
            osc3.type = 'sine';
            osc3.frequency.setValueAtTime(783.99, now + 0.3); // G5
            gain3.gain.setValueAtTime(0, now);
            gain3.gain.setValueAtTime(0.15, now + 0.3);
            gain3.gain.exponentialRampToValueAtTime(0.01, now + 2);
            osc3.connect(gain3);
            gain3.connect(audioContext.destination);
            osc3.start(now + 0.3);
            osc3.stop(now + 2);
        }

        function createConfetti() {
            const container = document.createElement('div');
            container.className = 'confetti';
            document.body.appendChild(container);

            const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dfe6e9', '#a29bfe'];

            for (let i = 0; i < 30; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.top = Math.random() * 30 + 'vh';
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDelay = Math.random() * 0.5 + 's';
                piece.style.animationDuration = (2 + Math.random() * 2) + 's';
                container.appendChild(piece);
            }

            setTimeout(() => container.remove(), 4000);
        }

        function celebrateTransition() {
            createConfetti();
            playChime();
        }

        // Initialize audio on first user interaction
        document.addEventListener('click', initAudio, { once: true });
        document.addEventListener('touchstart', initAudio, { once: true });
        document.addEventListener('touchend', initAudio, { once: true });

        // Schedule for drawing (sleep is one segment wrapping around midnight)
        const scheduleForDrawing = [
            { start: 20.25, end: 31, label: "Sleep", color: "#1e3a5f", emoji: "üò¥" }, // 8:15pm to 7am (31 = 24+7)
            { start: 7, end: 8, label: "Wake Up, Breakfast, Get Ready", color: "#4a7c59", emoji: "üåÖ" },
            { start: 8, end: 8.5, label: "Go to School", color: "#e8a838", emoji: "üöó" },
            { start: 8.5, end: 17, label: "School", color: "#5ba4d9", emoji: "üè´" },
            { start: 17, end: 18, label: "Play", color: "#7eb5e0", emoji: "üé®" },
            { start: 18, end: 19, label: "Dinner", color: "#e88a5a", emoji: "üçΩÔ∏è" },
            { start: 19, end: 19.5, label: "Bath & Jammies", color: "#c97b84", emoji: "üõÅ" },
            { start: 19.5, end: 20, label: "Stories & Candlelight", color: "#8b6aa8", emoji: "üìö" },
            { start: 20, end: 20.25, label: "Songs", color: "#5d4e7a", emoji: "üéµ" },
        ];

        // Schedule for time lookup (separate early/late sleep for logic)
        const schedule = [
            { start: 0, end: 7, label: "Sleep", color: "#1e3a5f", emoji: "üò¥" },
            { start: 7, end: 8, label: "Wake Up, Breakfast, Get Ready", color: "#4a7c59", emoji: "üåÖ" },
            { start: 8, end: 8.5, label: "Go to School", color: "#e8a838", emoji: "üöó" },
            { start: 8.5, end: 17, label: "School", color: "#5ba4d9", emoji: "üè´" },
            { start: 17, end: 18, label: "Play", color: "#7eb5e0", emoji: "üé®" },
            { start: 18, end: 19, label: "Dinner", color: "#e88a5a", emoji: "üçΩÔ∏è" },
            { start: 19, end: 19.5, label: "Bath & Jammies", color: "#c97b84", emoji: "üõÅ" },
            { start: 19.5, end: 20, label: "Stories & Candlelight", color: "#8b6aa8", emoji: "üìö" },
            { start: 20, end: 20.25, label: "Songs", color: "#5d4e7a", emoji: "üéµ" },
            { start: 20.25, end: 24, label: "Sleep", color: "#1e3a5f", emoji: "üò¥" },
        ];

        function hourToAngle(hour) {
            // 12am (midnight) at top = 0 degrees, goes clockwise
            return (hour / 24) * 360;
        }

        function polarToCartesian(centerX, centerY, radius, angleInDegrees) {
            const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
            return {
                x: centerX + (radius * Math.cos(angleInRadians)),
                y: centerY + (radius * Math.sin(angleInRadians))
            };
        }

        function describeArc(x, y, radius, startAngle, endAngle) {
            const start = polarToCartesian(x, y, radius, startAngle);
            const end = polarToCartesian(x, y, radius, endAngle);
            const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
            return [
                "M", x, y,
                "L", start.x, start.y,
                "A", radius, radius, 0, largeArcFlag, 1, end.x, end.y,
                "Z"
            ].join(" ");
        }

        function handleSegmentTap(label) {
            initAudio();
            playTapSound();
            highlightSection(label);
        }

        function drawClock() {
            const svg = document.getElementById('clock-svg');
            const centerX = 120;
            const centerY = 120;
            const radius = 100;

            // Draw schedule segments using the drawing schedule (sleep as one piece)
            scheduleForDrawing.forEach(item => {
                // Handle wrap-around for sleep (end > 24 means it wraps)
                const startAngle = hourToAngle(item.start % 24);
                const endAngle = hourToAngle(item.end % 24);

                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");

                // For sleep segment that wraps around midnight
                if (item.end > 24) {
                    // Draw as two arcs but in one path (or use a large arc)
                    const midnightAngle = 0;
                    const d1 = describeArc(centerX, centerY, radius, startAngle, 360);
                    const d2 = describeArc(centerX, centerY, radius, 0, endAngle);

                    // Create the combined sleep segment
                    path.setAttribute("d", describeArc(centerX, centerY, radius, startAngle, 360 + endAngle));
                } else {
                    path.setAttribute("d", describeArc(centerX, centerY, radius, startAngle, endAngle));
                }

                path.setAttribute("fill", item.color);
                path.setAttribute("class", "clock-segment");
                path.setAttribute("data-label", item.label);
                path.style.cursor = 'pointer';

                // Use both click and touchend for iPad compatibility
                path.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    handleSegmentTap(item.label);
                });
                path.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    handleSegmentTap(item.label);
                }, { passive: false });

                svg.appendChild(path);
            });

            // Draw divider lines (skip sleep - it's one continuous block)
            scheduleForDrawing.forEach((item, index) => {
                if (item.label === "Sleep") return; // No line for sleep

                const startAngle = hourToAngle(item.start);
                const outerPos = polarToCartesian(centerX, centerY, radius, startAngle);

                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", centerX);
                line.setAttribute("y1", centerY);
                line.setAttribute("x2", outerPos.x);
                line.setAttribute("y2", outerPos.y);
                line.setAttribute("stroke", "rgba(255,255,255,0.2)");
                line.setAttribute("stroke-width", "1");
                svg.appendChild(line);
            });

            // Draw hour markers and numbers
            for (let hour = 0; hour < 24; hour += 3) {
                const angle = hourToAngle(hour);
                const innerPos = polarToCartesian(centerX, centerY, radius * 0.85, angle);
                const outerPos = polarToCartesian(centerX, centerY, radius * 0.95, angle);

                // Tick mark
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", innerPos.x);
                line.setAttribute("y1", innerPos.y);
                line.setAttribute("x2", outerPos.x);
                line.setAttribute("y2", outerPos.y);
                line.setAttribute("stroke", "rgba(255,255,255,0.6)");
                line.setAttribute("stroke-width", "2");
                svg.appendChild(line);

                // Hour number
                const textPos = polarToCartesian(centerX, centerY, radius * 0.73, angle);
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", textPos.x);
                text.setAttribute("y", textPos.y);
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("dominant-baseline", "middle");
                text.setAttribute("fill", "rgba(255,255,255,0.9)");
                text.setAttribute("font-size", "10");
                text.setAttribute("font-weight", "bold");
                text.textContent = hour === 0 ? "12a" : hour === 12 ? "12p" : hour < 12 ? `${hour}a` : `${hour-12}p`;
                svg.appendChild(text);
            }
        }

        function getCurrentActivity(hour) {
            for (const item of schedule) {
                if (hour >= item.start && hour < item.end) {
                    return item;
                }
            }
            return schedule[0];
        }

        let lastActivityLabel = null;

        function updateClock() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();

            const currentHour = hours + minutes / 60 + seconds / 3600;
            const hourAngle = hourToAngle(currentHour);

            // Update hour hand
            const hand = document.getElementById('hand');
            hand.style.transform = `translateX(-50%) rotate(${hourAngle}deg)`;

            // Update second hand (full rotation every 60 seconds)
            const secondAngle = (seconds / 60) * 360;
            const secondHand = document.getElementById('second-hand');
            secondHand.style.transform = `translateX(-50%) rotate(${secondAngle}deg)`;

            const activity = getCurrentActivity(currentHour);

            // Check for activity transition
            if (lastActivityLabel !== null && lastActivityLabel !== activity.label) {
                celebrateTransition();
            }
            lastActivityLabel = activity.label;

            document.getElementById('activity-text').textContent = activity.emoji + " " + activity.label;
            updateLegendHighlight(activity.label);

            const timeStr = now.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            document.getElementById('current-time').textContent = timeStr;
        }

        const legendItems = [
            { label: "Sleep", color: "#1e3a5f", emoji: "üò¥" },
            { label: "Wake Up, Breakfast, Get Ready", color: "#4a7c59", emoji: "üåÖ" },
            { label: "Go to School", color: "#e8a838", emoji: "üöó" },
            { label: "School", color: "#5ba4d9", emoji: "üè´" },
            { label: "Play", color: "#7eb5e0", emoji: "üé®" },
            { label: "Dinner", color: "#e88a5a", emoji: "üçΩÔ∏è" },
            { label: "Bath & Jammies", color: "#c97b84", emoji: "üõÅ" },
            { label: "Stories & Candlelight", color: "#8b6aa8", emoji: "üìö" },
            { label: "Songs", color: "#5d4e7a", emoji: "üéµ" },
        ];

        function playTapSound() {
            if (!audioContext) return;

            // Soft, mellow tap sound
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(392, audioContext.currentTime); // G4 - lower, softer
            gain.gain.setValueAtTime(0.1, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.3);
        }

        function handleLegendTap(label) {
            initAudio();
            playTapSound();
            highlightSection(label);
        }

        function buildLegend() {
            const legend = document.getElementById('legend');

            legendItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'legend-item';
                div.dataset.label = item.label;
                div.innerHTML = `
                    <div class="legend-color" style="background: ${item.color}">${item.emoji}</div>
                    <span>${item.label}</span>
                `;
                // Use both click and touchend for iPad compatibility
                div.addEventListener('click', (e) => {
                    e.preventDefault();
                    handleLegendTap(item.label);
                });
                div.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    handleLegendTap(item.label);
                });
                legend.appendChild(div);
            });
        }

        let userHighlight = null;
        let userHighlightTimeout = null;

        function updateLegendHighlight(currentLabel) {
            document.querySelectorAll('.legend-item').forEach(item => {
                // Active = current time, Highlighted = user tapped
                if (item.dataset.label === currentLabel) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function highlightSection(label) {
            // Clear any existing timeout
            if (userHighlightTimeout) {
                clearTimeout(userHighlightTimeout);
            }

            userHighlight = label;

            // Highlight legend item
            document.querySelectorAll('.legend-item').forEach(item => {
                if (item.dataset.label === label) {
                    item.classList.add('highlighted');
                } else {
                    item.classList.remove('highlighted');
                }
            });

            // Highlight clock segment
            document.querySelectorAll('.clock-segment').forEach(seg => {
                const segLabel = seg.getAttribute('data-label');
                if (segLabel === label) {
                    seg.setAttribute('class', 'clock-segment highlighted');
                } else {
                    seg.setAttribute('class', 'clock-segment');
                }
            });

            // Start fade out after 1 second
            userHighlightTimeout = setTimeout(() => {
                fadeOutHighlight();
            }, 1000);
        }

        function fadeOutHighlight() {
            // Add fading class to trigger CSS transition
            document.querySelectorAll('.legend-item.highlighted').forEach(item => {
                item.classList.add('fading');
            });
            document.querySelectorAll('.clock-segment.highlighted').forEach(seg => {
                seg.setAttribute('class', 'clock-segment highlighted fading');
            });

            // Remove all classes after fade completes
            setTimeout(() => {
                clearHighlight();
            }, 1000);
        }

        function clearHighlight() {
            userHighlight = null;
            document.querySelectorAll('.legend-item').forEach(item => {
                item.classList.remove('highlighted', 'fading');
            });
            document.querySelectorAll('.clock-segment').forEach(seg => {
                seg.setAttribute('class', 'clock-segment');
            });
        }

        // Initialize
        drawClock();
        buildLegend();
        updateClock();
        setInterval(updateClock, 1000);
    </script>
</body>
</html>
